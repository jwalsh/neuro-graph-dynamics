<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neurosymbolic Knowledge Graph</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
    <script src="/static/js/home.js"></script>
</head>
<body>
    {% include 'header.html' %}
    <main>
        <section id="node-operations">
            <h2>Node Operations</h2>
            <div class="container">
                <div class="left-column">
                    <h3>Add Node</h3>
                    <input type="text" id="new-node-name" placeholder="Node name">
                    <input type="text" id="new-node-attributes" placeholder="Attributes (JSON format)">
                    <input type="text" id="new-node-lifetime" placeholder="Lifetime (optional)">
                    <button id="add-node-btn">Add Node</button>

                    <h3>Query/Enrich Node</h3>
                    <select id="node-select">
                        <option value="">Select a philosopher</option>
                    </select>
                    <button id="query-node-btn">Query Node</button>
                    <button id="enrich-node-btn">Enrich Node</button>

                    <h3>Update Contemporary Philosophers</h3>
                    <button id="update-contemporary-btn">Update Contemporary Philosophers</button>
                </div>
                <div class="right-column">
                    <div id="node-info-container">
                        <pre id="node-info"></pre>
                        <i class="copy-icon fas fa-copy" data-clipboard-target="#node-info"></i>
                    </div>
                </div>
            </div>
        </section>

        <section id="graph-visualization">
            <h2>Knowledge Graph Visualization</h2>
            <div id="graph-container">
                <div id="mermaid-graph"></div>
            </div>
            <button id="export-json-btn">Export Graph to JSON</button>
        </section>
    </main>
<<<<<<< HEAD

    <script>
        function escapeLabel(label) {
            return label.replace(/[&<>'"]/g, function(char) {
                switch (char) {
                    case '&': return '&amp;';
                    case '<': return '&lt;';
                    case '>': return '&gt;';
                    case "'": return '&#39;';
                    case '"': return '&quot;';
                    default: return char;
                }
            });
        }

        $(document).ready(function() {
            // Initialize clipboard.js
            new ClipboardJS('.copy-icon');

            // Load nodes
            function loadNodes() {
                $.get('/get_nodes', function(nodes) {
                    var select = $('#node-select');
                    select.empty();
                    select.append($('<option></option>').val('').text('Select a node'));
                    nodes.forEach(function(node) {
                        select.append($('<option></option>').val(node).text(node));
                    });
                });
            }

            loadNodes();

            // Add node
            $('#add-node-btn').click(function() {
                var nodeName = $('#new-node-name').val();
                var attributes = $('#new-node-attributes').val();
                var lifetime = $('#new-node-lifetime').val();

                if (!nodeName) {
                    alert('Please enter a node name.');
                    return;
                }

                try {
                    attributes = attributes ? JSON.parse(attributes) : {};
                } catch (e) {
                    alert('Invalid JSON format for attributes.');
                    return;
                }

                $.ajax({
                    url: '/add_node',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        node_name: nodeName,
                        attributes: attributes,
                        lifetime: lifetime
                    }),
                    success: function(response) {
                        alert(response.message);
                        $('#new-node-name').val('');
                        $('#new-node-attributes').val('');
                        $('#new-node-lifetime').val('');
                        loadNodes();
                        loadAndRenderGraph();
                    },
                    error: function(xhr, status, error) {
                        alert('Error: ' + error);
                    }
                });
            });
            
            // Query node
            $('#query-node-btn').click(function() {
                var nodeName = $('#node-select').val();
                
                if (!nodeName) {
                    alert('Please select a node.');
                    return;
                }
                
                $.ajax({
                    url: '/enrich_node',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        node_name: nodeName
                    }),
                    success: function(response) {
                        $('#node-info').text(response.original_info);
                    },
                    error: function(xhr, status, error) {
                        $('#node-info').text('Error: ' + error);
                    }
                });
            });

            // Enrich node
            $('#enrich-node-btn').click(function() {
                var nodeName = $('#node-select').val();
                
                if (!nodeName) {
                    alert('Please select a node.');
                    return;
                }
                
                $.ajax({
                    url: '/enrich_node',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        node_name: nodeName
                    }),
                    success: function(response) {
                        $('#node-info').text('Original Info:\n' + response.original_info + '\n\nEnriched Info:\n' + response.enriched_info);
                    },
                    error: function(xhr, status, error) {
                        $('#node-info').text('Error: ' + error);
                    }
                });
            });

            // Update Contemporary Philosophers
            $('#update-contemporary-btn').click(function() {
                $.ajax({
                    url: '/update_contemporary_philosophers',
                    method: 'POST',
                    contentType: 'application/json',
                    success: function(response) {
                        alert(response.message);
                        loadNodes();
                        loadAndRenderGraph();
                    },
                    error: function(xhr, status, error) {
                        alert('Error: ' + error);
                    }
                });
            });

            // Export JSON
            $('#export-json-btn').click(function() {
                window.location.href = '/export_json';
            });

            // Load and render graph
            function loadAndRenderGraph() {
                $.get('/graph_data', function(data) {
                    var nodes = data.nodes;
                    var links = data.links;
                    var mermaidCode = 'graph TD\n';

                    links.forEach(function(link) {
                        mermaidCode += `    ${escapeLabel(link.source)}["${escapeLabel(nodes.find(n => n.id === link.source).label || link.source)}"] -->|${escapeLabel(link.relation)}| ${escapeLabel(link.target)}["${escapeLabel(nodes.find(n => n.id === link.target).label || link.target)}"]\n`;
                    });

                    var mermaidDiv = document.getElementById('mermaid-graph');
                    mermaidDiv.innerHTML = mermaidCode;
                    mermaid.init(undefined, mermaidDiv);
                });
            }

            // Initial graph load
            loadAndRenderGraph();
        });
    </script>
=======
    {% include 'footer.html' %}
>>>>>>> 2eac9e0f2e869dc191ee25cc75fb11b246107744
</body>
</html>
